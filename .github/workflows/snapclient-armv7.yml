name: build-snapclient-armv7

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Snapclient v0.34.0
      uses: actions/checkout@v4
      with:
        repository: badaix/snapcast
        ref: v0.34.0

    - name: Download Android NDK
      run: |
        wget https://dl.google.com/android/repository/android-ndk-r26d-linux.zip -O ndk.zip
        unzip ndk.zip
        mv android-ndk-r26d ndk

    - name: Configure & Build (Android armv7, OpenSL ES)
      run: |
        mkdir build && cd build
        cmake .. \
          -DCMAKE_TOOLCHAIN_FILE=$GITHUB_WORKSPACE/ndk/build/cmake/android.toolchain.cmake \
          -DANDROID_ABI=armeabi-v7a \
          -DANDROID_PLATFORM=android-21 \
          -DBUILD_CLIENT=ON \
          -DBUILD_SERVER=OFF \
          -DBUILD_TESTS=OFF \
          -DBUILD_WI_CLIENT=OFF \
          -DUSE_PULSE=OFF \
          -DUSE_OBoe=OFF \
          -DUSE_OSS=OFF \
          -DUSE_ALSA=OFF \
          -DUSE_PORTAUDIO=OFF \
          -DUSE_PIPEWIRE=OFF
        cmake --build . --config Release -j$(nproc)

    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: snapclient-armv7
        path: build/client/snapclient
